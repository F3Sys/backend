import{u as O,f as K,r as p,d as Z,g as V,h as ee,c as r,a as e,t as h,e as y,w as H,b as B,i as P,v as R,j as S,k as N,F as k,l as A,o as c,m as te,n as ae}from"./index-Cw4TOO_S.js";import{c as I,C as ne,A as se,p as le,a as oe,b as ie,L as ue,P as re,d as ce,e as de,S as pe,f as he,g as ye,D as ve,h as me,F as be,_ as fe}from"./_plugin-vue_export-helper-DyF8oJNZ.js";/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=I("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=I("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=I("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),w=O(),ke=K("food",()=>{const D=p([]),q=p(0),z=p(0),C=p([]),l=p([]),v=p([]);function f(){D.value=[],z.value=0,q.value=0,C.value=[],l.value=[],v.value=[]}async function M(){const[n]=await Promise.all([b(),m(),_(),g(),T()]);return n}async function x(){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const o=await fetch(u+"protected/foods",{method:"GET",headers:n}).then(d=>d.json());return D.value=o,!0}catch{return!1}}async function F(n,u){const o=new Headers;o.append("Authorization","Bearer "+w.key),o.append("Content-Type","application/json");const d="https://api.aicj.io/";try{return(await fetch(d+"protected/push/foodstall",{method:"POST",headers:o,body:JSON.stringify({f3sid:n,foods:u})})).ok}catch{return!1}}async function g(){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const o=await fetch(u+"protected/table",{method:"GET",headers:n}).then(d=>d.json());return l.value=o,!0}catch{return!1}}async function m(){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const o=await fetch(u+"protected/count",{method:"GET",headers:n}).then(d=>d.json());return z.value=o.count,!0}catch{return!1}}async function b(){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const o=await fetch(u+"protected/quantity",{method:"GET",headers:n}).then(d=>d.json());return q.value=o.quantity,!0}catch{return!1}}async function _(){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const o=await fetch(u+"protected/food_count",{method:"GET",headers:n}).then(d=>d.json());return C.value=o,!0}catch{return!1}}async function j(n,u,o){const d=new Headers;d.append("Authorization","Bearer "+w.key),d.append("Content-Type","application/json");const L="https://api.aicj.io/";try{return(await fetch(L+"protected/push/foodstall",{method:"PATCH",headers:d,body:JSON.stringify({id:n,food_id:u,quantity:o})})).ok}catch{return!1}}async function T(){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const o=await fetch(u+"protected/data/foodstall",{method:"GET",headers:n}).then(d=>d.json());return v.value=o,!0}catch{return!1}}return{foods:D,quantity:q,counts:C,count:z,table:l,line_graph_data:v,getFoods:x,sendFood:F,getTable:g,getCount:m,getQuantity:b,getFoodCount:_,getData:T,updateFood:j,update:M,clear:f}}),we={class:"container-fluid"},Ce={class:"parent"},Fe={class:"Order"},je={class:"mb-0"},qe=["disabled"],ze=["aria-invalid"],xe={key:0,id:"f3sid-helper"},Te=["aria-invalid"],Le=["id","name","onUpdate:modelValue"],Pe=["for"],Ae={key:0,id:"food-helper"},De={key:0},Ve=["onUpdate:modelValue"],Me=["value"],Ee=["aria-busy","disabled"],Je={class:"flex items-center mx-auto"},Be={class:"Stats"},Re={class:"text-nowrap"},Ne={class:"striped mb-0"},Ie={scope:"row",class:"text-sm"},He={class:"Table"},Oe={class:"text-nowrap"},Ge={class:"striped mb-0"},Ue={scope:"row"},Qe={key:0},Ye=["disabled"],Xe=["value"],$e={key:1},We={key:2},Ke=["disabled"],Ze={key:3},et={class:"grid grid-cols-1 gap-2"},tt=["onClick","disabled"],at=["onClick","disabled"],nt=["onClick","disabled"],st={class:"Donut-Chart"},lt={style:{zoom:"1.1"}},ot={class:"Line-Chart"},it={style:{zoom:"1.1"}},ut=["open"],rt={class:"max-w-lg"},ct=21,dt=Z({__name:"FoodView",setup(D){ne.register(se,le,oe,ie,ue,re,ce,de);const q=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],z=p(""),C=O(),l=ke(),v=p(!1),f=p(!1),M=p(!1),x=p(0),F=p(0),g=p(1),m=p(!1),b=p(""),_=p(!1),j=p(!1),T=new pe({minLength:7,alphabet:"23456789CFGHJMPQRVWX",blocklist:new Set([])}),n=p(new Map(l.table.map(s=>[s.id,!1]))),u=p(new Map),o=V(()=>Array.from(u.value.entries()).filter(([s,a])=>a.isSelected).reduce((s,[a,t])=>{const i=l.foods.find(W=>W.id===a);return s+(i?i.price*t.quantity:0)},0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),d=async([s])=>{T.decode(s.rawValue).length===2&&(b.value=s.rawValue,M.value=!0,f.value=!1)},L=()=>{f.value=!f.value},E=async s=>{console.log(x.value,F.value,g.value),m.value=!0,await l.updateFood(Number(x.value),Number(F.value),Number(g.value))&&await l.update()&&(m.value=!1,n.value.set(s,!1))},G=s=>{n.value.set(s,!1)},U=s=>{for(const[a,t]of n.value)if(t&&a!==s.id)return;F.value=s.food_id,g.value=s.quantity,x.value=s.id,n.value.set(s.id,!0)},Q=async()=>{if(v.value=!0,b.value===""||T.decode(b.value).length!==2?(v.value=!1,_.value=!0):_.value=!1,Array.from(u.value.values()).some(t=>t.isSelected&&t.quantity>=1)?j.value=!1:(v.value=!1,j.value=!0),_.value||j.value){v.value=!1;return}await l.sendFood(b.value,Array.from(u.value.entries()).filter(([t,i])=>i.isSelected).map(([t,i])=>({id:Number(t),quantity:Number(i.quantity)})))&&await l.update()&&(b.value="",u.value=new Map(l.foods.map(i=>[i.id,{name:i.name,isSelected:!1,quantity:1}]))),v.value=!1},Y=V(()=>l.counts.map(s=>s.name)),J=V(()=>l.counts.map(s=>s.count)),X=V(()=>l.counts.map(s=>s.quantity));let $=Array(ct).fill(0).reduce((s,a,t)=>(t%2===0?s.push((t/2+8).toString().padStart(2,"0")+":00"):s.push((Math.floor(t/2)+8).toString().padStart(2,"0")+":30"),s),[]);return ee(()=>{(async()=>(await Promise.all([l.getFoods(),l.getData(),l.getQuantity(),l.getFoodCount(),l.getCount(),l.getTable()]),z.value=l.counts.reduce((s,a)=>s+a.price*a.quantity,0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"}),u.value=new Map(l.foods.map(s=>[s.id,{name:s.name,isSelected:!1,quantity:1}]))))()}),(s,a)=>(c(),r("main",we,[e("div",Ce,[e("div",Fe,[e("article",null,[e("header",null,[e("hgroup",je,[e("h2",null,h(y(C).name),1),e("p",null,h(y(C).type.charAt(0)+y(C).type.toLowerCase().slice(1)),1)])]),e("form",{onSubmit:H(Q,["prevent"])},[e("fieldset",{disabled:v.value},[e("label",null,[a[4]||(a[4]=B(" F3SiD ")),e("fieldset",{role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":_.value,"aria-describedby":"f3sid-helper"},[P(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>b.value=t),name:"f3sid",class:"!h-10"},null,512),[[R,b.value]]),e("button",{type:"submit",onClick:H(L,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[S(y(he),{class:"m-2 size-6"})])],8,ze),_.value?(c(),r("small",xe," F3SiDが無効です ")):N("",!0)]),e("fieldset",{"aria-invalid":j.value,"aria-describedby":"food-helper"},[a[5]||(a[5]=e("legend",null,"商品:",-1)),(c(!0),r(k,null,A(u.value,t=>(c(),r(k,{key:t[0].toString()},[P(e("input",{type:"checkbox",id:t[0].toString(),name:t[1].name,"onUpdate:modelValue":i=>t[1].isSelected=i},null,8,Le),[[te,t[1].isSelected]]),e("label",{for:t[0].toString()},h(t[1].name),9,Pe)],64))),128))],8,Te),j.value?(c(),r("small",Ae," 商品を選択してください ")):N("",!0),(c(!0),r(k,null,A(u.value,t=>(c(),r(k,{key:t[0]},[t[1].isSelected?(c(),r("label",De,[B(h(t[1].name)+" ",1),P(e("input",{type:"number",name:"quantity",min:"1","onUpdate:modelValue":i=>t[1].quantity=i,class:"!h-10"},null,8,Ve),[[R,t[1].quantity]])])):N("",!0)],64))),128)),e("label",null,[a[6]||(a[6]=B(" 値段 ")),e("input",{value:o.value,name:"price",class:"!h-10",readonly:""},null,8,Me)])],8,qe),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":v.value,disabled:v.value},[e("div",Je,[S(y(ye),{class:"size-4 mr-1"}),a[7]||(a[7]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,Ee)],32)])]),e("div",Be,[e("article",Re,[a[10]||(a[10]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("div",null,[e("table",Ne,[a[9]||(a[9]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"個数"),e("th",{scope:"col"},"総額")])],-1)),e("tbody",null,[(c(!0),r(k,null,A(y(l).counts,t=>(c(),r("tr",null,[e("th",Ie,h(t.name),1),e("td",null,h(t.price.toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,h(t.count),1),e("td",null,h(t.quantity),1),e("td",null,h((t.quantity*t.price).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1)]))),256))]),e("tfoot",null,[e("tr",null,[a[8]||(a[8]=e("th",{scope:"row",colspan:"2",class:"text-align-center"},"合計",-1)),e("td",null,h(y(l).count),1),e("td",null,h(y(l).quantity),1),e("td",null,h(z.value),1)])])])])])]),e("div",He,[e("article",Oe,[a[12]||(a[12]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",Ge,[a[11]||(a[11]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"購入時刻"),e("th",{scope:"col",class:"text-center"},"編集")])],-1)),e("tbody",null,[(c(!0),r(k,null,A(y(l).table,t=>(c(),r("tr",null,[e("th",Ue,h(t.f3sid),1),n.value.get(t.id)?(c(),r("td",Qe,[P(e("select",{disabled:m.value,name:"newFoodId","onUpdate:modelValue":a[1]||(a[1]=i=>F.value=i),class:"!mb-0 !py-0 !h-8",required:""},[(c(!0),r(k,null,A(y(l).foods,i=>(c(),r("option",{value:i.id,key:i.id},h(i.name),9,Xe))),128))],8,Ye),[[ae,F.value]])])):(c(),r("td",$e,h(t.food_name),1)),n.value.get(t.id)?(c(),r("td",We,[P(e("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=i=>g.value=i),class:"!mb-0 !py-0 !h-8 !w-20",disabled:m.value},null,8,Ke),[[R,g.value]])])):(c(),r("td",Ze,h(t.quantity),1)),e("td",null,h((t.price*t.quantity).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,h(new Date(t.created_at).toLocaleTimeString("ja-JP")),1),e("td",null,[e("div",et,[n.value.get(t.id)?(c(),r(k,{key:0},[e("button",{onClick:i=>G(t.id),disabled:m.value,class:"flex items-center justify-center size-8 p-0 mr-auto outline secondary"},[S(y(Se),{class:"m-1 size-5"})],8,tt),e("button",{onClick:i=>E(t.id),disabled:m.value,class:"flex items-center justify-center size-8 p-0 outline"},[S(y(ge),{class:"m-1 size-5"})],8,at)],64)):(c(),r("button",{key:1,onClick:i=>U(t),disabled:m.value,class:"flex items-center justify-center size-8 p-0 mx-auto outline contrast"},[S(y(_e),{class:"m-2 size-3"})],8,nt))])])]))),256))])])])]),e("div",st,[e("article",lt,[a[13]||(a[13]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"セット別売上割合"),e("p",null,"Percentage of total count and quantity by set")])],-1)),S(y(ve),{data:{labels:Y.value,datasets:[{label:"回数",data:J.value,backgroundColor:[...q.slice(0,J.value.length)]},{label:"個数",data:X.value,backgroundColor:[...q.slice(0,J.value.length)]}]},options:{animation:!1,plugins:{legend:{labels:{font:{size:15}}}}}},null,8,["data"])])]),e("div",ot,[e("article",it,[a[14]||(a[14]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数と個数のグラフ"),e("p",null,"The graph of count and quantity vs time")])],-1)),S(y(me),{data:{labels:y($),datasets:y(l).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),e("dialog",{open:f.value},[e("article",rt,[a[15]||(a[15]=e("header",null,[e("hgroup",{style:{"margin-bottom":"0px"}},[e("h2",null,"F3SiD"),e("p",null,"Scan the F3SiD")])],-1)),S(y(be),{paused:!f.value,onDetect:d},null,8,["paused"]),e("footer",null,[e("button",{onClick:a[3]||(a[3]=t=>{f.value=!f.value}),class:"secondary"}," Close ")])])],8,ut)]))}}),yt=fe(dt,[["__scopeId","data-v-b5ee2d1b"]]);export{yt as default};
