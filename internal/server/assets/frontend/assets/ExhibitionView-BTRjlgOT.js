import{u as j,f as k,r as b,d as F,h as T,c as y,a as e,t as m,e as n,w as C,b as L,i as z,v as E,j as g,k as V,F as A,l as D,o as S}from"./index-Cw4TOO_S.js";import{C as B,A as P,p as M,a as N,b as R,L as H,P as G,d as J,e as O,S as q,f as I,g as Q,h as X,F as U,_ as W}from"./_plugin-vue_export-helper-DyF8oJNZ.js";const w=j(),$=k("exhibition",()=>{const _=b(0),p=b([]),l=b([]);function r(){_.value=0,p.value=[],l.value=[]}async function u(){const[a]=await Promise.all([h(),i(),v()]);return a}async function x(a){const o=new Headers;o.append("Authorization","Bearer "+w.key),o.append("Content-Type","application/json");const s="https://api.aicj.io/";try{return(await fetch(s+"protected/push/exhibition",{method:"POST",headers:o,body:JSON.stringify({f3sid:a})})).ok}catch{return!1}}async function i(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/table",{method:"GET",headers:a}).then(d=>d.json());return p.value=s,!0}catch{return!1}}async function h(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/count",{method:"GET",headers:a}).then(d=>d.json());return _.value=s.count,!0}catch{return!1}}async function v(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/data/exhibition",{method:"GET",headers:a}).then(d=>d.json());return l.value=s,!0}catch{return!1}}return{table:p,count:_,line_graph_data:l,sendExhibition:x,getTable:i,getCount:h,getData:v,update:u,clear:r}}),K={class:"container-fluid"},Y={class:"parent"},Z={class:"Order"},ee={class:"mb-0"},te=["disabled"],ae=["aria-invalid"],se={key:0,id:"f3sid-helper"},ne=["aria-busy","disabled"],oe={class:"flex items-center mx-auto"},le={class:"Stats"},ie={class:"striped mb-auto"},re={scope:"row"},ue={class:"Table"},de={style:{zoom:"1.1"}},ce={class:"striped mb-0"},pe={scope:"row"},he={class:"Line-Chart"},fe={style:{zoom:"1.1"}},be=["open"],me={class:"max-w-lg"},ve=21,_e=F({__name:"ExhibitionView",setup(_){B.register(P,M,N,R,H,G,J,O);const p=j(),l=$(),r=b(!1),u=b(!1),x=b(!1),i=b(""),h=b(!1),v=new q({minLength:7,alphabet:"23456789CFGHJMPQRVWX",blocklist:new Set([])}),a=async([f])=>{v.decode(f.rawValue).length===2&&(i.value=f.rawValue,x.value=!0,u.value=!1)},o=()=>{u.value=!u.value},s=async()=>{if(r.value=!0,i.value===""||v.decode(i.value).length!==2?(r.value=!1,h.value=!0):h.value=!1,h.value){r.value=!1;return}await l.sendExhibition(i.value)&&await l.update()&&(i.value=""),r.value=!1};let d=Array(ve).fill(0).reduce((f,t,c)=>(c%2===0?f.push((c/2+8).toString().padStart(2,"0")+":00"):f.push((Math.floor(c/2)+8).toString().padStart(2,"0")+":30"),f),[]);return T(()=>{(async()=>await l.update())()}),(f,t)=>(S(),y("main",K,[e("div",Y,[e("div",Z,[e("article",null,[e("header",null,[e("hgroup",ee,[e("h2",null,m(n(p).name),1),e("p",null,m(n(p).type.charAt(0)+n(p).type.toLowerCase().slice(1)),1)])]),e("form",{onSubmit:C(s,["prevent"])},[e("fieldset",{disabled:r.value},[e("label",null,[t[2]||(t[2]=L(" F3SiD ")),e("fieldset",{role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":h.value,"aria-describedby":"f3sid-helper"},[z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c),name:"f3sid",class:"!h-10"},null,512),[[E,i.value]]),e("button",{type:"submit",onClick:C(o,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[g(n(I),{class:"m-2 size-6"})])],8,ae),h.value?(S(),y("small",se," F3SiDが無効です ")):V("",!0)])],8,te),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":r.value,disabled:r.value},[e("div",oe,[g(n(Q),{class:"size-4 mr-1"}),t[3]||(t[3]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,ne)],32)])]),e("div",le,[e("article",null,[t[5]||(t[5]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("table",ie,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名前"),e("th",{scope:"col"},"回数")])],-1)),e("tbody",null,[e("tr",null,[e("th",re,m(n(p).name),1),e("td",null,m(n(l).count.toLocaleString("ja-JP")),1)])])])])]),e("div",ue,[e("article",de,[t[7]||(t[7]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",ce,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"入室時刻")])],-1)),e("tbody",null,[(S(!0),y(A,null,D(n(l).table,c=>(S(),y("tr",null,[e("th",pe,m(c.f3sid),1),e("td",null,m(new Date(c.created_at).toLocaleTimeString("ja-JP")),1)]))),256))])])])]),e("div",he,[e("article",fe,[t[8]||(t[8]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数のグラフ"),e("p",null,"The graph of count vs time")])],-1)),g(n(X),{data:{labels:n(d),datasets:n(l).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),e("dialog",{open:u.value},[e("article",me,[t[9]||(t[9]=e("header",null,[e("hgroup",{style:{"margin-bottom":"0px"}},[e("h2",null,"F3SiD"),e("p",null,"Scan the F3SiD")])],-1)),g(n(U),{paused:!u.value,onDetect:a},null,8,["paused"]),e("footer",null,[e("button",{onClick:t[1]||(t[1]=c=>{u.value=!u.value}),class:"secondary"}," Close ")])])],8,be)]))}}),Se=W(_e,[["__scopeId","data-v-dd139249"]]);export{Se as default};
