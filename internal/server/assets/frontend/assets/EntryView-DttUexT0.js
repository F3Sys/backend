import{u as E,f as F,r as h,d as D,g as k,h as A,c as v,a as e,t as y,e as r,w as x,b as V,i as B,v as P,j as _,k as H,F as L,l as z,o as b}from"./index-Cw4TOO_S.js";import{C as M,A as N,p as R,a as G,b as J,L as O,P as q,d as I,e as Q,S as X,f as U,g as W,D as $,h as K,F as Y,_ as Z}from"./_plugin-vue_export-helper-DyF8oJNZ.js";const S=E(),ee=F("entry",()=>{const w=h(0),m=h([]),n=h([]),u=h([]);function d(){w.value=0,m.value=[],n.value=[],u.value=[]}async function T(){const[a]=await Promise.all([g(),C(),f(),j()]);return a}async function p(a){const o=new Headers;o.append("Authorization","Bearer "+S.key),o.append("Content-Type","application/json");const s="https://api.aicj.io/";try{return(await fetch(s+"protected/push/entry",{method:"POST",headers:o,body:JSON.stringify({f3sid:a})})).ok}catch{return!1}}async function f(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/table",{method:"GET",headers:a}).then(c=>c.json());return n.value=s,!0}catch{return!1}}async function g(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/count",{method:"GET",headers:a}).then(c=>c.json());return w.value=s.count,!0}catch{return!1}}async function C(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/entry_count",{method:"GET",headers:a}).then(c=>c.json());return m.value=s,!0}catch{return!1}}async function j(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const s=await fetch(o+"protected/data/entry",{method:"GET",headers:a}).then(c=>c.json());return u.value=s,!0}catch{return!1}}return{counts:m,table:n,line_graph_data:u,count:w,sendEntry:p,getTable:f,getCount:g,getEntryCount:C,getData:j,update:T,clear:d}}),te={class:"container-fluid"},ae={class:"parent"},se={class:"Order"},ne={class:"mb-0"},oe=["disabled"],le=["aria-invalid"],re={key:0,id:"f3sid-helper"},ie=["aria-busy","disabled"],ue={class:"flex items-center mx-auto"},ce={class:"Stats"},de={class:"text-nowrap"},pe={class:"striped mb-0"},he={scope:"row"},fe={class:"Table"},ye={class:"text-nowrap"},me={class:"striped mb-0"},ve={scope:"row"},be={class:"Donut-Chart"},ge={style:{zoom:"1.1"}},_e={class:"Line-Chart"},Se={style:{zoom:"1.1"}},we=["open"],Ce={class:"max-w-lg"},je=21,Te=D({__name:"EntryView",setup(w){M.register(N,R,G,J,O,q,I,Q);const m=E(),n=ee(),u=h(!1),d=h(!1),T=h(!1),p=h(""),f=h(!1),g=new X({minLength:7,alphabet:"23456789CFGHJMPQRVWX",blocklist:new Set([])}),C=async([i])=>{g.decode(i.rawValue).length===2&&(p.value=i.rawValue,T.value=!0,d.value=!1)},j=()=>{d.value=!d.value},a=async()=>{if(u.value=!0,p.value===""||g.decode(p.value).length!==2?(u.value=!1,f.value=!0):f.value=!1,f.value){u.value=!1;return}await n.sendEntry(p.value)&&await n.update()&&(p.value=""),u.value=!1},o=k(()=>n.counts.map(i=>i.type)),s=k(()=>n.counts.map(i=>i.count));let c=Array(je).fill(0).reduce((i,t,l)=>(l%2===0?i.push((l/2+8).toString().padStart(2,"0")+":00"):i.push((Math.floor(l/2)+8).toString().padStart(2,"0")+":30"),i),[]);return A(()=>{(async()=>await n.update())()}),(i,t)=>(b(),v("main",te,[e("div",ae,[e("div",se,[e("article",null,[e("header",null,[e("hgroup",ne,[e("h2",null,y(r(m).name),1),e("p",null,y(r(m).type.charAt(0)+r(m).type.toLowerCase().slice(1)),1)])]),e("form",{onSubmit:x(a,["prevent"])},[e("fieldset",{disabled:u.value},[e("label",null,[t[2]||(t[2]=V(" F3SiD ")),e("fieldset",{role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":f.value,"aria-describedby":"f3sid-helper"},[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),name:"f3sid",class:"!h-10"},null,512),[[P,p.value]]),e("button",{type:"submit",onClick:x(j,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[_(r(U),{class:"m-2 size-6"})])],8,le),f.value?(b(),v("small",re," F3SiDが無効です ")):H("",!0)])],8,oe),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":u.value,disabled:u.value},[e("div",ue,[_(r(W),{class:"size-4 mr-1"}),t[3]||(t[3]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,ie)],32)])]),e("div",ce,[e("article",de,[t[6]||(t[6]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("table",pe,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"種類"),e("th",{scope:"col"},"回数")])],-1)),e("tbody",null,[(b(!0),v(L,null,z(r(n).counts,l=>(b(),v("tr",null,[e("th",he,y(l.type),1),e("td",null,y(l.count.toLocaleString("ja-JP")),1)]))),256))]),e("tfoot",null,[e("tr",null,[t[4]||(t[4]=e("th",{scope:"row",class:"text-align-center"},"合計",-1)),e("td",null,y(r(n).count.toLocaleString("ja-JP")),1)])])])])]),e("div",fe,[e("article",ye,[t[8]||(t[8]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",me,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"種類"),e("th",{scope:"col"},"時刻")])],-1)),e("tbody",null,[(b(!0),v(L,null,z(r(n).table,l=>(b(),v("tr",null,[e("th",ve,y(l.f3sid),1),e("td",null,y(l.type),1),e("td",null,y(new Date(l.created_at).toLocaleTimeString("ja-JP")),1)]))),256))])])])]),e("div",be,[e("article",ge,[t[9]||(t[9]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"種別人数割合"),e("p",null,"Percentage of total count by type")])],-1)),_(r($),{data:{labels:o.value,datasets:[{label:"回数",data:s.value}]},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}}}},null,8,["data"])])]),e("div",_e,[e("article",Se,[t[10]||(t[10]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数のグラフ"),e("p",null,"The graph of count vs time")])],-1)),_(r(K),{data:{labels:r(c),datasets:r(n).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),e("dialog",{open:d.value},[e("article",Ce,[t[11]||(t[11]=e("header",null,[e("hgroup",{style:{"margin-bottom":"0px"}},[e("h2",null,"F3SiD"),e("p",null,"Scan the F3SiD")])],-1)),_(r(Y),{paused:!d.value,onDetect:C},null,8,["paused"]),e("footer",null,[e("button",{onClick:t[1]||(t[1]=l=>{d.value=!d.value}),class:"secondary"}," Close ")])])],8,we)]))}}),Le=Z(Te,[["__scopeId","data-v-38f70d48"]]);export{Le as default};
