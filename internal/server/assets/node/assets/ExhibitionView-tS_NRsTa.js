import{u as T,f as A,r as v,d as V,h as D,c as g,a as e,t as m,e as n,w as C,b as B,i as P,j as M,v as N,k as _,l as R,F as H,m as G,o as S}from"./index-DDo2_VMk.js";import{C as J,A as O,p as I,a as q,b as K,L as Q,P as X,d as U,e as W,S as $,u as Y,f as Z,g as ee,h as te,i as ae,F as se,_ as ne}from"./_plugin-vue_export-helper-DRxNFOdN.js";const w=T(),le=A("exhibition",()=>{const y=v(0),o=v([]),i=v([]);function u(){y.value=0,o.value=[],i.value=[]}async function d(){const[a]=await Promise.all([h(),r(),b()]);return a}async function x(a){const l=new Headers;l.append("Authorization","Bearer "+w.key),l.append("Content-Type","application/json");const s="https://api.aicj.io/";try{return(await fetch(s+"protected/push/exhibition",{method:"POST",headers:l,body:JSON.stringify({f3sid:a})})).ok}catch{return!1}}async function r(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const l="https://api.aicj.io/";try{const s=await fetch(l+"protected/table",{method:"GET",headers:a}).then(c=>c.json());return o.value=s,!0}catch{return!1}}async function h(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const l="https://api.aicj.io/";try{const s=await fetch(l+"protected/count",{method:"GET",headers:a}).then(c=>c.json());return y.value=s.count,!0}catch{return!1}}async function b(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const l="https://api.aicj.io/";try{const s=await fetch(l+"protected/data/exhibition",{method:"GET",headers:a}).then(c=>c.json());return i.value=s,!0}catch{return!1}}return{table:o,count:y,line_graph_data:i,sendExhibition:x,getTable:r,getCount:h,getData:b,update:d,clear:u}}),oe={class:"container-fluid"},ie={class:"parent"},re={class:"Order"},ue={class:"mb-0"},de=["disabled"],ce=["aria-invalid"],pe={key:0,id:"f3sid-helper"},he=["aria-busy","disabled"],fe={class:"flex items-center mx-auto"},ve={class:"Stats"},me={class:"striped mb-auto"},be={scope:"row"},ye={class:"Table"},ge={style:{zoom:"1.1"}},_e={class:"striped mb-0"},Se={scope:"row"},we={class:"Line-Chart"},xe={style:{zoom:"1.1"}},Ce=["open"],Te={class:"max-w-lg"},Fe=21,je=V({__name:"ExhibitionView",setup(y){J.register(O,I,q,K,Q,X,U,W);const o=T(),i=le(),u=v(!1),d=v(!1),x=v(!1),r=v(""),h=v(!1),b=new $({minLength:7,alphabet:"23456789CFGHJMPQRVWX",blocklist:new Set([])}),a=async([f])=>{b.decode(f.rawValue).length===2&&(r.value=f.rawValue,x.value=!0,d.value=!1)},l=()=>{d.value=!d.value},s=async()=>{if(u.value=!0,r.value===""||b.decode(r.value).length!==2?(u.value=!1,h.value=!0):h.value=!1,h.value){u.value=!1;return}await i.sendExhibition(r.value)&&await i.update()&&(r.value=""),u.value=!1};let c=Array(Fe).fill(0).reduce((f,t,p)=>(p%2===0?f.push((p/2+8).toString().padStart(2,"0")+":00"):f.push((Math.floor(p/2)+8).toString().padStart(2,"0")+":30"),f),[]);const{charging:F,chargingTime:j,dischargingTime:k,level:L}=Y(),{resume:z,isActive:E}=Z(()=>{o.sendStatus(F.value,j.value,k.value,L.value)},6e4,{immediate:!1});return D(()=>{(async()=>await i.update())(),!E.value&&o.canSendStatus&&z()}),(f,t)=>(S(),g("main",oe,[e("div",ie,[e("div",re,[e("article",null,[e("header",null,[e("hgroup",ue,[e("h2",null,m(n(o).name),1),e("p",null,m(n(o).type.charAt(0)+n(o).type.toLowerCase().slice(1)),1)])]),e("form",{onSubmit:C(s,["prevent"])},[e("fieldset",{disabled:u.value},[e("label",null,[t[3]||(t[3]=B(" F3SiD ")),e("fieldset",{onKeydown:t[1]||(t[1]=P(C(()=>{},["prevent"]),["enter"])),role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":h.value,"aria-describedby":"f3sid-helper"},[M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=p=>r.value=p),name:"f3sid",class:"!h-10"},null,512),[[N,r.value]]),e("button",{type:"submit",onClick:C(l,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[_(n(ee),{class:"m-2 size-6"})])],40,ce),h.value?(S(),g("small",pe," F3SiDが無効です ")):R("",!0)])],8,de),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":u.value,disabled:u.value},[e("div",fe,[_(n(te),{class:"size-4 mr-1"}),t[4]||(t[4]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,he)],32)])]),e("div",ve,[e("article",null,[t[6]||(t[6]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("table",me,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名前"),e("th",{scope:"col"},"回数")])],-1)),e("tbody",null,[e("tr",null,[e("th",be,m(n(o).name),1),e("td",null,m(n(i).count.toLocaleString("ja-JP")),1)])])])])]),e("div",ye,[e("article",ge,[t[8]||(t[8]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",_e,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"入室時刻")])],-1)),e("tbody",null,[(S(!0),g(H,null,G(n(i).table,p=>(S(),g("tr",null,[e("th",Se,m(p.f3sid),1),e("td",null,m(new Date(p.created_at).toLocaleTimeString("ja-JP")),1)]))),256))])])])]),e("div",we,[e("article",xe,[t[9]||(t[9]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数のグラフ"),e("p",null,"The graph of count vs time")])],-1)),_(n(ae),{data:{labels:n(c),datasets:n(i).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),e("dialog",{open:d.value},[e("article",Te,[t[10]||(t[10]=e("header",null,[e("hgroup",{style:{"margin-bottom":"0px"}},[e("h2",null,"F3SiD"),e("p",null,"Scan the F3SiD")])],-1)),_(n(se),{paused:!d.value,onDetect:a},null,8,["paused"]),e("footer",null,[e("button",{onClick:t[2]||(t[2]=p=>{d.value=!d.value}),class:"secondary"}," Close ")])])],8,Ce)]))}}),ze=ne(je,[["__scopeId","data-v-4c1c8f68"]]);export{ze as default};
