import{u as x,g as N,r as h,d as O,h as z,i as H,c as y,a as e,t as m,j as r,k as M,w as k,b as R,e as G,v as J,f as _,l as I,F as E,m as L,o as b}from"./index-DTX86rsU.js";import"./pure-tnRjEown.js";import{C as q,A as K,p as U,a as Q,b as X,L as $,P as W,d as Y,e as Z,u as ee,S as te,f as ae,D as se,g as ne,_ as oe}from"./_plugin-vue_export-helper-DFOPYPfm.js";import{_ as le}from"./ScannerComponent.vue_vue_type_script_setup_true_lang--jpzH8WO.js";import{n as re}from"./sqids-DOZV5yO7.js";import{u as ie}from"./index-BbEcSMdZ.js";const S=x(),ue=N("entry",()=>{const w=h(0),d=h([]),n=h([]),i=h([]);function v(){w.value=0,d.value=[],n.value=[],i.value=[]}async function C(){const[a]=await Promise.all([g(),j(),f(),T()]);return a}async function p(a){const o=new Headers;o.append("Authorization","Bearer "+S.key),o.append("Content-Type","application/json");const u="https://api.aicj.io/";try{return(await fetch(u+"protected/push/entry",{method:"POST",headers:o,body:JSON.stringify({f3sid:a})})).ok}catch{return!1}}async function f(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const u=await fetch(o+"protected/table",{method:"GET",headers:a}).then(c=>c.json());return n.value=u,!0}catch{return!1}}async function g(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const u=await fetch(o+"protected/count",{method:"GET",headers:a}).then(c=>c.json());return w.value=u.count,!0}catch{return!1}}async function j(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const u=await fetch(o+"protected/entry_count",{method:"GET",headers:a}).then(c=>c.json());return d.value=u,!0}catch{return!1}}async function T(){const a=new Headers;a.append("Authorization","Bearer "+S.key),a.append("Content-Type","application/json");const o="https://api.aicj.io/";try{const u=await fetch(o+"protected/data/entry",{method:"GET",headers:a}).then(c=>c.json());return i.value=u,!0}catch{return!1}}return{counts:d,table:n,line_graph_data:i,count:w,sendEntry:p,getTable:f,getCount:g,getEntryCount:j,getData:T,update:C,clear:v}}),ce={class:"container-fluid"},de={class:"parent"},pe={class:"Order"},he={class:"mb-0"},fe=["disabled"],me=["aria-invalid"],ve={key:0,id:"f3sid-helper"},ye=["aria-busy","disabled"],be={class:"flex items-center mx-auto"},ge={class:"Stats"},_e={class:"text-nowrap"},Se={class:"striped mb-0"},we={scope:"row"},je={class:"Table"},Te={class:"text-nowrap"},Ce={class:"striped mb-0"},ke={scope:"row"},ze={class:"Donut-Chart"},Ee={style:{zoom:"1.1"}},Le={class:"Line-Chart"},xe={style:{zoom:"1.1"}},De=21,Ve=O({__name:"EntryView",setup(w){q.register(K,U,Q,X,$,W,Y,Z);const d=x(),n=ue(),i=h(!1),v=h(!1),C=h(!1),p=h(""),f=h(!1),g=re(),j=async l=>{g.decode(l.rawValue).length===2&&(p.value=l.rawValue,C.value=!0,v.value=!1)},T=()=>{v.value=!v.value},a=async()=>{if(i.value=!0,p.value===""||g.decode(p.value).length!==2?(i.value=!1,f.value=!0):f.value=!1,f.value){i.value=!1;return}await n.sendEntry(p.value)&&await n.update()&&(p.value=""),i.value=!1},o=z(()=>n.counts.map(l=>l.type)),u=z(()=>n.counts.map(l=>l.count)),c=Array(De).fill(0).reduce((l,t,s)=>(s%2===0?l.push((s/2+8).toString().padStart(2,"0")+":00"):l.push((Math.floor(s/2)+8).toString().padStart(2,"0")+":30"),l),[]),{charging:D,chargingTime:V,dischargingTime:A,level:F}=ee(),{resume:B,isActive:P}=ie(async()=>{await d.sendStatus(D.value,V.value,A.value,F.value)},6e4,{immediate:!1});return H(()=>{(async()=>await n.update())(),!P.value&&d.canSendStatus&&B()}),(l,t)=>(b(),y("main",ce,[e("div",de,[e("div",pe,[e("article",null,[e("header",null,[e("hgroup",he,[e("h2",null,m(r(d).name),1),e("p",null,m(r(d).type.charAt(0)+r(d).type.toLowerCase().slice(1)),1)])]),e("form",{onKeydown:t[1]||(t[1]=M(k(()=>{},["prevent"]),["enter"])),onSubmit:k(a,["prevent"])},[e("fieldset",{disabled:i.value},[e("label",null,[t[3]||(t[3]=R(" F3SiD ")),e("fieldset",{role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":f.value,"aria-describedby":"f3sid-helper"},[G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),name:"f3sid",class:"!h-10"},null,512),[[J,p.value]]),e("button",{type:"submit",onClick:k(T,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[_(r(te),{class:"m-2 size-6"})])],8,me),f.value?(b(),y("small",ve," F3SiDが無効です ")):I("",!0)])],8,fe),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":i.value,disabled:i.value},[e("div",be,[_(r(ae),{class:"size-4 mr-1"}),t[4]||(t[4]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,ye)],32)])]),e("div",ge,[e("article",_e,[t[7]||(t[7]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("table",Se,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"種類"),e("th",{scope:"col"},"回数")])],-1)),e("tbody",null,[(b(!0),y(E,null,L(r(n).counts,s=>(b(),y("tr",{key:s.type},[e("th",we,m(s.type),1),e("td",null,m(s.count.toLocaleString("ja-JP")),1)]))),128))]),e("tfoot",null,[e("tr",null,[t[5]||(t[5]=e("th",{scope:"row",class:"text-align-center"},"合計",-1)),e("td",null,m(r(n).count.toLocaleString("ja-JP")),1)])])])])]),e("div",je,[e("article",Te,[t[9]||(t[9]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",Ce,[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"種類"),e("th",{scope:"col"},"時刻")])],-1)),e("tbody",null,[(b(!0),y(E,null,L(r(n).table,s=>(b(),y("tr",{key:s.f3sid+s.created_at},[e("th",ke,m(s.f3sid),1),e("td",null,m(s.type),1),e("td",null,m(new Date(s.created_at).toLocaleTimeString("ja-JP")),1)]))),128))])])])]),e("div",ze,[e("article",Ee,[t[10]||(t[10]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"種別人数割合"),e("p",null,"Percentage of total count by type")])],-1)),_(r(se),{data:{labels:o.value,datasets:[{label:"回数",data:u.value}]},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}}}},null,8,["data"])])]),e("div",Le,[e("article",xe,[t[11]||(t[11]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数のグラフ"),e("p",null,"The graph of count vs time")])],-1)),_(r(ne),{data:{labels:r(c),datasets:r(n).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),_(le,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),onOnDetect:j},null,8,["modelValue"])]))}}),He=oe(Ve,[["__scopeId","data-v-3cb626eb"]]);export{He as default};
