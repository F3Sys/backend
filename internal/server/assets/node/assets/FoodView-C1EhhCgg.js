import{u as Q,g as ue,r as h,d as ie,h as T,i as re,c as u,a as e,t as l,j as m,k as ce,w as O,b as M,e as V,v as H,f as S,l as I,F as g,m as x,n as de,o as i,p as pe,q as ye,s as he}from"./index-DTX86rsU.js";import{c as U,C as me,A as ve,p as be,a as fe,b as ge,L as _e,P as ke,d as Se,e as we,u as Ce,S as je,f as Fe,D as qe,g as ze,_ as xe}from"./_plugin-vue_export-helper-DFOPYPfm.js";import{_ as Le}from"./ScannerComponent.vue_vue_type_script_setup_true_lang--jpzH8WO.js";import{n as Pe}from"./sqids-DOZV5yO7.js";import{u as Te}from"./index-BbEcSMdZ.js";import"./pure-tnRjEown.js";/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=U("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=U("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=U("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),w=Q(),De=ue("food",()=>{const D=h([]),L=h(0),A=h(0),f=h([]),o=h([]),b=h([]);function C(){D.value=[],A.value=0,L.value=0,f.value=[],o.value=[],b.value=[]}async function N(){const[s]=await Promise.all([k(),_(),q(),F(),B()]);return s}async function J(){const s=new Headers;s.append("Authorization","Bearer "+w.key),s.append("Content-Type","application/json");const r="https://api.aicj.io/";try{const p=await fetch(r+"protected/foods",{method:"GET",headers:s}).then(d=>d.json());return D.value=p,!0}catch{return!1}}async function j(s,r){const p=new Headers;p.append("Authorization","Bearer "+w.key),p.append("Content-Type","application/json");const d="https://api.aicj.io/";try{return(await fetch(d+"protected/push/foodstall",{method:"POST",headers:p,body:JSON.stringify({f3sid:s,foods:r})})).ok}catch{return!1}}async function F(){const s=new Headers;s.append("Authorization","Bearer "+w.key),s.append("Content-Type","application/json");const r="https://api.aicj.io/";try{const p=await fetch(r+"protected/table",{method:"GET",headers:s}).then(d=>d.json());return o.value=p,!0}catch{return!1}}async function _(){const s=new Headers;s.append("Authorization","Bearer "+w.key),s.append("Content-Type","application/json");const r="https://api.aicj.io/";try{const p=await fetch(r+"protected/count",{method:"GET",headers:s}).then(d=>d.json());return A.value=p.count,!0}catch{return!1}}async function k(){const s=new Headers;s.append("Authorization","Bearer "+w.key),s.append("Content-Type","application/json");const r="https://api.aicj.io/";try{const p=await fetch(r+"protected/quantity",{method:"GET",headers:s}).then(d=>d.json());return L.value=p.quantity,!0}catch{return!1}}async function q(){const s=new Headers;s.append("Authorization","Bearer "+w.key),s.append("Content-Type","application/json");const r="https://api.aicj.io/";try{const p=await fetch(r+"protected/food_count",{method:"GET",headers:s}).then(d=>d.json());return f.value=p,f.value=f.value.filter(d=>d.count>0),!0}catch{return!1}}async function z(s,r,p){const d=new Headers;d.append("Authorization","Bearer "+w.key),d.append("Content-Type","application/json");const E="https://api.aicj.io/";try{return(await fetch(E+"protected/push/foodstall",{method:"PATCH",headers:d,body:JSON.stringify({id:s,food_id:r,quantity:p})})).ok}catch{return!1}}async function B(){const s=new Headers;s.append("Authorization","Bearer "+w.key);const r="https://api.aicj.io/";try{const p=await fetch(r+"protected/data/foodstall",{method:"GET",headers:s}).then(d=>d.json());return b.value=p,!0}catch{return!1}}return{foods:D,quantity:L,counts:f,count:A,table:o,line_graph_data:b,getFoods:J,sendFood:j,updateFood:z,update:N,clear:C}}),Be={class:"container-fluid"},Ee={class:"parent"},Me={class:"Order"},Ie={class:"mb-0"},Ne=["disabled"],Re=["aria-invalid"],Oe={key:0,id:"f3sid-helper"},He=["aria-invalid"],Ue=["id","name","onUpdate:modelValue"],Ye={key:0,id:"food-helper"},Ge={key:0},Qe=["onUpdate:modelValue"],$e=["value"],Xe=["aria-busy","disabled"],Ke={class:"flex items-center mx-auto"},We={class:"Stats"},Ze={class:"text-nowrap"},et={class:"striped mb-0"},tt={scope:"row",class:"text-sm"},at={class:"stripped mb-0"},nt={scope:"row",class:"text-sm"},st={class:"Table"},lt={class:"text-nowrap"},ot={class:"striped mb-0"},ut={scope:"row"},it={key:0},rt=["disabled"],ct=["value"],dt={key:1},pt={key:2},yt=["disabled"],ht={key:3},mt={class:"grid grid-cols-1 gap-2"},vt=["onClick","disabled"],bt=["onClick","disabled"],ft=["onClick","disabled"],gt={class:"Donut-Chart"},_t={style:{zoom:"1.1"}},kt={class:"Line-Chart"},St={style:{zoom:"1.1"}},wt=21,Ct=ie({__name:"FoodView",setup(D){me.register(ve,be,fe,ge,_e,ke,Se,we);const L=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],A=T(()=>o.counts.reduce((n,t)=>n+t.price*t.count,0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),f=Q(),o=De(),b=h(!1),C=h(!1),N=h(!1),J=h(0),j=h(0),F=h(1),_=h(!1),k=h(""),q=h(!1),z=h(!1),B=Pe(),s=h(new Map(o.table.map(n=>[n.id,!1]))),r=h(new Map),p=T(()=>Array.from(r.value.entries()).filter(([,n])=>n.isSelected).reduce((n,[t,c])=>{const a=o.foods.find(y=>y.id===t);return n+(a?a.price*c.quantity:0)},0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),d=async n=>{B.decode(n.rawValue).length===2&&(k.value=n.rawValue,N.value=!0,C.value=!1)},E=()=>{C.value=!C.value},Y=async n=>{console.log(J.value,j.value,F.value),_.value=!0,await o.updateFood(Number(J.value),Number(j.value),Number(F.value))&&await o.update()&&(_.value=!1,s.value.set(n,!1))},$=n=>{s.value.set(n,!1)},X=n=>{for(const[t,c]of s.value)if(c&&t!==n.id)return;j.value=n.food_id,F.value=n.quantity,J.value=n.id,s.value.set(n.id,!0)},K=async()=>{if(b.value=!0,k.value===""||B.decode(k.value).length!==2?(b.value=!1,q.value=!0):q.value=!1,Array.from(r.value.values()).some(c=>c.isSelected&&c.quantity>=1)?z.value=!1:(b.value=!1,z.value=!0),q.value||z.value){b.value=!1;return}await o.sendFood(k.value,Array.from(r.value.entries()).filter(([,c])=>c.isSelected).map(([c,a])=>({id:Number(c),quantity:Number(a.quantity)})))&&await o.update()&&(k.value="",r.value=new Map(o.foods.map(a=>[a.id,{name:a.name,isSelected:!1,quantity:1}]))),b.value=!1},W=T(()=>o.counts.map(n=>n.name)),G=T(()=>o.counts.reduce((n,t)=>{const c=t.date;return n[c]||(n[c]=[]),n[c].push(t),n},{})),R=T(()=>o.counts.map(n=>n.count)),Z=T(()=>o.counts.map(n=>n.quantity)),ee=Array(wt).fill(0).reduce((n,t,c)=>(c%2===0?n.push((c/2+8).toString().padStart(2,"0")+":00"):n.push((Math.floor(c/2)+8).toString().padStart(2,"0")+":30"),n),[]),{charging:te,chargingTime:ae,dischargingTime:ne,level:se}=Ce(),{resume:le,isActive:oe}=Te(async()=>{await f.sendStatus(te.value,ae.value,ne.value,se.value)},6e4,{immediate:!1});return re(()=>{(async()=>(await o.getFoods(),await o.update(),r.value=new Map(o.foods.map(n=>[n.id,{name:n.name,isSelected:!1,quantity:1}]))))(),!oe.value&&f.canSendStatus&&le()}),(n,t)=>{const c=de("hroup");return i(),u("main",Be,[e("div",Ee,[e("div",Me,[e("article",null,[e("header",null,[e("hgroup",Ie,[e("h2",null,l(m(f).name),1),e("p",null,l(m(f).type.charAt(0)+m(f).type.toLowerCase().slice(1)),1)])]),e("form",{onKeydown:t[1]||(t[1]=ce(O(()=>{},["prevent"]),["enter"])),onSubmit:O(K,["prevent"])},[e("fieldset",{disabled:b.value},[e("label",null,[t[5]||(t[5]=M(" F3SiD ")),e("fieldset",{role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":q.value,"aria-describedby":"f3sid-helper"},[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),name:"f3sid",class:"!h-10"},null,512),[[H,k.value]]),e("button",{type:"submit",onClick:O(E,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[S(m(je),{class:"m-2 size-6"})])],8,Re),q.value?(i(),u("small",Oe," F3SiDが無効です ")):I("",!0)]),e("fieldset",{"aria-invalid":z.value,"aria-describedby":"food-helper"},[t[6]||(t[6]=e("legend",null,"商品:",-1)),(i(!0),u(g,null,x(r.value,a=>(i(),u("label",{key:a[0].toString()},[V(e("input",{type:"checkbox",id:a[0].toString(),name:a[1].name,"onUpdate:modelValue":y=>a[1].isSelected=y},null,8,Ue),[[pe,a[1].isSelected]]),M(" "+l(a[1].name),1)]))),128))],8,He),z.value?(i(),u("small",Ye," 商品を選択してください ")):I("",!0),(i(!0),u(g,null,x(r.value,a=>(i(),u(g,{key:a[0]},[a[1].isSelected?(i(),u("label",Ge,[M(l(a[1].name)+" ",1),V(e("input",{type:"number",name:"quantity",min:"1","onUpdate:modelValue":y=>a[1].quantity=y,class:"!h-10"},null,8,Qe),[[H,a[1].quantity]])])):I("",!0)],64))),128)),e("label",null,[t[7]||(t[7]=M(" 値段 ")),e("input",{value:p.value,name:"price",class:"!h-10",readonly:""},null,8,$e)])],8,Ne),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":b.value,disabled:b.value},[e("div",Ke,[S(m(Fe),{class:"size-4 mr-1"}),t[8]||(t[8]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,Xe)],32)])]),e("div",We,[e("article",Ze,[t[16]||(t[16]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("div",null,[(i(!0),u(g,null,x(G.value,(a,y)=>(i(),u(g,{key:y},[S(c,null,{default:ye(()=>[e("h3",null,l(y+"日"),1)]),_:2},1024),e("table",et,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"個数"),e("th",{scope:"col"},"総額")])],-1)),e("tbody",null,[(i(!0),u(g,null,x(a,v=>(i(),u("tr",{key:v.id},[e("th",tt,l(v.name),1),e("td",null,l(v.price.toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,l(v.count),1),e("td",null,l(v.quantity),1),e("td",null,l((v.count*v.price).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1)]))),128))]),e("tfoot",null,[e("tr",null,[t[9]||(t[9]=e("th",{scope:"row",colspan:"2",class:"text-align-center"},"合計",-1)),e("td",null,l(a.reduce((v,P)=>v+P.count,0)),1),e("td",null,l(a.reduce((v,P)=>v+P.quantity,0)),1),e("td",null,l(a.reduce((v,P)=>v+P.count*P.price,0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1)])])]),t[11]||(t[11]=e("hr",{class:"mt-0"},null,-1))],64))),128)),Object.keys(G.value).length>1?(i(),u(g,{key:0},[t[14]||(t[14]=e("hgroup",null,[e("h3",null,"合計")],-1)),e("table",at,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"日付"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"個数"),e("th",{scope:"col"},"総額")])],-1)),e("tbody",null,[(i(!0),u(g,null,x(m(o).counts,a=>(i(),u("tr",{key:a.id},[e("th",nt,l(a.name),1),e("td",null,l(a.date),1),e("td",null,l(a.price.toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,l(a.count),1),e("td",null,l(a.quantity),1),e("td",null,l((a.count*a.price).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1)]))),128))]),e("tfoot",null,[e("tr",null,[t[12]||(t[12]=e("th",{scope:"row",colspan:"3",class:"text-align-center"}," 合計 ",-1)),e("td",null,l(m(o).count),1),e("td",null,l(m(o).quantity),1),e("td",null,l(A.value),1)])])]),t[15]||(t[15]=e("hr",{class:"m-0"},null,-1))],64)):I("",!0)])])]),e("div",st,[e("article",lt,[t[18]||(t[18]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",ot,[t[17]||(t[17]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"購入時刻"),e("th",{scope:"col",class:"text-center"},"編集")])],-1)),e("tbody",null,[(i(!0),u(g,null,x(m(o).table,a=>(i(),u("tr",{key:a.f3sid+a.created_at},[e("th",ut,l(a.f3sid),1),s.value.get(a.id)?(i(),u("td",it,[V(e("select",{disabled:_.value,name:"newFoodId","onUpdate:modelValue":t[2]||(t[2]=y=>j.value=y),class:"!mb-0 !py-0 !h-8",required:""},[(i(!0),u(g,null,x(m(o).foods,y=>(i(),u("option",{value:y.id,key:y.id},l(y.name),9,ct))),128))],8,rt),[[he,j.value]])])):(i(),u("td",dt,l(a.food_name),1)),s.value.get(a.id)?(i(),u("td",pt,[V(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=y=>F.value=y),class:"!mb-0 !py-0 !h-8 !w-20",disabled:_.value},null,8,yt),[[H,F.value]])])):(i(),u("td",ht,l(a.quantity),1)),e("td",null,l((a.price*a.quantity).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,l(new Date(a.created_at).toLocaleTimeString("ja-JP")),1),e("td",null,[e("div",mt,[s.value.get(a.id)?(i(),u(g,{key:0},[e("button",{onClick:y=>$(a.id),disabled:_.value,class:"flex items-center justify-center size-8 p-0 mr-auto outline secondary"},[S(m(Ve),{class:"m-1 size-5"})],8,vt),e("button",{onClick:y=>Y(a.id),disabled:_.value,class:"flex items-center justify-center size-8 p-0 outline"},[S(m(Ae),{class:"m-1 size-5"})],8,bt)],64)):(i(),u("button",{key:1,onClick:y=>X(a),disabled:_.value,class:"flex items-center justify-center size-8 p-0 mx-auto outline contrast"},[S(m(Je),{class:"m-2 size-3"})],8,ft))])])]))),128))])])])]),e("div",gt,[e("article",_t,[t[19]||(t[19]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"セット別売上割合"),e("p",null,"Percentage of total count and quantity by set")])],-1)),S(m(qe),{data:{labels:W.value,datasets:[{label:"回数",data:R.value,backgroundColor:[...L.slice(0,R.value.length)]},{label:"個数",data:Z.value,backgroundColor:[...L.slice(0,R.value.length)]}]},options:{animation:!1,plugins:{legend:{labels:{font:{size:15}}}}}},null,8,["data"])])]),e("div",kt,[e("article",St,[t[20]||(t[20]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数と個数のグラフ"),e("p",null,"The graph of count and quantity vs time")])],-1)),S(m(ze),{data:{labels:m(ee),datasets:m(o).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),S(Le,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=a=>C.value=a),onOnDetect:d},null,8,["modelValue"])])}}}),Pt=xe(Ct,[["__scopeId","data-v-71bdefda"]]);export{Pt as default};
