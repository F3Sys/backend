import{u as O,f as se,r as p,d as le,g as D,h as oe,c as r,a as e,t as h,e as y,w as J,b as R,i as ie,j as P,v as I,k,l as N,F as w,m as A,o as c,n as ue,p as re}from"./index-DDo2_VMk.js";import{c as H,C as ce,A as de,p as pe,a as he,b as ye,L as ve,P as me,d as fe,e as be,S as ge,u as _e,f as Se,g as ke,h as we,D as Ce,i as Fe,F as je,_ as qe}from"./_plugin-vue_export-helper-DRxNFOdN.js";/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=H("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=H("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-vue-next v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=H("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),C=O(),Le=se("food",()=>{const V=p([]),q=p(0),z=p(0),b=p([]),i=p([]),v=p([]);function g(){V.value=[],z.value=0,q.value=0,b.value=[],i.value=[],v.value=[]}async function M(){const[n]=await Promise.all([f(),m(),S(),_(),T()]);return n}async function x(){const n=new Headers;n.append("Authorization","Bearer "+C.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const l=await fetch(u+"protected/foods",{method:"GET",headers:n}).then(d=>d.json());return V.value=l,!0}catch{return!1}}async function F(n,u){const l=new Headers;l.append("Authorization","Bearer "+C.key),l.append("Content-Type","application/json");const d="https://api.aicj.io/";try{return(await fetch(d+"protected/push/foodstall",{method:"POST",headers:l,body:JSON.stringify({f3sid:n,foods:u})})).ok}catch{return!1}}async function _(){const n=new Headers;n.append("Authorization","Bearer "+C.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const l=await fetch(u+"protected/table",{method:"GET",headers:n}).then(d=>d.json());return i.value=l,!0}catch{return!1}}async function m(){const n=new Headers;n.append("Authorization","Bearer "+C.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const l=await fetch(u+"protected/count",{method:"GET",headers:n}).then(d=>d.json());return z.value=l.count,!0}catch{return!1}}async function f(){const n=new Headers;n.append("Authorization","Bearer "+C.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const l=await fetch(u+"protected/quantity",{method:"GET",headers:n}).then(d=>d.json());return q.value=l.quantity,!0}catch{return!1}}async function S(){const n=new Headers;n.append("Authorization","Bearer "+C.key),n.append("Content-Type","application/json");const u="https://api.aicj.io/";try{const l=await fetch(u+"protected/food_count",{method:"GET",headers:n}).then(d=>d.json());return b.value=l,!0}catch{return!1}}async function j(n,u,l){const d=new Headers;d.append("Authorization","Bearer "+C.key),d.append("Content-Type","application/json");const L="https://api.aicj.io/";try{return(await fetch(L+"protected/push/foodstall",{method:"PATCH",headers:d,body:JSON.stringify({id:n,food_id:u,quantity:l})})).ok}catch{return!1}}async function T(){const n=new Headers;n.append("Authorization","Bearer "+C.key);const u="https://api.aicj.io/";try{const l=await fetch(u+"protected/data/foodstall",{method:"GET",headers:n}).then(d=>d.json());return v.value=l,!0}catch{return!1}}return{foods:V,quantity:q,counts:b,count:z,table:i,line_graph_data:v,getFoods:x,sendFood:F,getTable:_,getCount:m,getQuantity:f,getFoodCount:S,getData:T,updateFood:j,update:M,clear:g}}),Pe={class:"container-fluid"},Ae={class:"parent"},Ve={class:"Order"},De={class:"mb-0"},Me=["disabled"],Be=["aria-invalid"],Ee={key:0,id:"f3sid-helper"},Je=["aria-invalid"],Re=["id","name","onUpdate:modelValue"],Ie=["for"],Ne={key:0,id:"food-helper"},He={key:0},Oe=["onUpdate:modelValue"],Ge=["value"],Ue=["aria-busy","disabled"],Qe={class:"flex items-center mx-auto"},Ye={class:"Stats"},Xe={class:"text-nowrap"},$e={class:"striped mb-0"},Ke={scope:"row",class:"text-sm"},We={class:"Table"},Ze={class:"text-nowrap"},et={class:"striped mb-0"},tt={scope:"row"},at={key:0},nt=["disabled"],st=["value"],lt={key:1},ot={key:2},it=["disabled"],ut={key:3},rt={class:"grid grid-cols-1 gap-2"},ct=["onClick","disabled"],dt=["onClick","disabled"],pt=["onClick","disabled"],ht={class:"Donut-Chart"},yt={style:{zoom:"1.1"}},vt={class:"Line-Chart"},mt={style:{zoom:"1.1"}},ft=["open"],bt={class:"max-w-lg"},gt=21,_t=le({__name:"FoodView",setup(V){ce.register(de,pe,he,ye,ve,me,fe,be);const q=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],z=p(""),b=O(),i=Le(),v=p(!1),g=p(!1),M=p(!1),x=p(0),F=p(0),_=p(1),m=p(!1),f=p(""),S=p(!1),j=p(!1),T=new ge({minLength:7,alphabet:"23456789CFGHJMPQRVWX",blocklist:new Set([])}),n=p(new Map(i.table.map(s=>[s.id,!1]))),u=p(new Map),l=D(()=>Array.from(u.value.entries()).filter(([s,a])=>a.isSelected).reduce((s,[a,t])=>{const o=i.foods.find(ne=>ne.id===a);return s+(o?o.price*t.quantity:0)},0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),d=async([s])=>{T.decode(s.rawValue).length===2&&(f.value=s.rawValue,M.value=!0,g.value=!1)},L=()=>{g.value=!g.value},B=async s=>{console.log(x.value,F.value,_.value),m.value=!0,await i.updateFood(Number(x.value),Number(F.value),Number(_.value))&&await i.update()&&(m.value=!1,n.value.set(s,!1))},G=s=>{n.value.set(s,!1)},U=s=>{for(const[a,t]of n.value)if(t&&a!==s.id)return;F.value=s.food_id,_.value=s.quantity,x.value=s.id,n.value.set(s.id,!0)},Q=async()=>{if(v.value=!0,f.value===""||T.decode(f.value).length!==2?(v.value=!1,S.value=!0):S.value=!1,Array.from(u.value.values()).some(t=>t.isSelected&&t.quantity>=1)?j.value=!1:(v.value=!1,j.value=!0),S.value||j.value){v.value=!1;return}await i.sendFood(f.value,Array.from(u.value.entries()).filter(([t,o])=>o.isSelected).map(([t,o])=>({id:Number(t),quantity:Number(o.quantity)})))&&await i.update()&&(f.value="",u.value=new Map(i.foods.map(o=>[o.id,{name:o.name,isSelected:!1,quantity:1}]))),v.value=!1},Y=D(()=>i.counts.map(s=>s.name)),E=D(()=>i.counts.map(s=>s.count)),X=D(()=>i.counts.map(s=>s.quantity));let $=Array(gt).fill(0).reduce((s,a,t)=>(t%2===0?s.push((t/2+8).toString().padStart(2,"0")+":00"):s.push((Math.floor(t/2)+8).toString().padStart(2,"0")+":30"),s),[]);const{charging:K,chargingTime:W,dischargingTime:Z,level:ee}=_e(),{resume:te,isActive:ae}=Se(()=>{b.sendStatus(K.value,W.value,Z.value,ee.value)},6e4,{immediate:!1});return oe(()=>{(async()=>(await i.update(),z.value=i.counts.reduce((s,a)=>s+a.price*a.quantity,0).toLocaleString("ja-JP",{style:"currency",currency:"JPY"}),u.value=new Map(i.foods.map(s=>[s.id,{name:s.name,isSelected:!1,quantity:1}]))))(),!ae.value&&b.canSendStatus&&te()}),(s,a)=>(c(),r("main",Pe,[e("div",Ae,[e("div",Ve,[e("article",null,[e("header",null,[e("hgroup",De,[e("h2",null,h(y(b).name),1),e("p",null,h(y(b).type.charAt(0)+y(b).type.toLowerCase().slice(1)),1)])]),e("form",{onSubmit:J(Q,["prevent"])},[e("fieldset",{disabled:v.value},[e("label",null,[a[5]||(a[5]=R(" F3SiD ")),e("fieldset",{onKeydown:a[1]||(a[1]=ie(J(()=>{},["prevent"]),["enter"])),role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":S.value,"aria-describedby":"f3sid-helper"},[P(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>f.value=t),name:"f3sid",class:"!h-10"},null,512),[[I,f.value]]),e("button",{type:"submit",onClick:J(L,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[k(y(ke),{class:"m-2 size-6"})])],40,Be),S.value?(c(),r("small",Ee," F3SiDが無効です ")):N("",!0)]),e("fieldset",{"aria-invalid":j.value,"aria-describedby":"food-helper"},[a[6]||(a[6]=e("legend",null,"商品:",-1)),(c(!0),r(w,null,A(u.value,t=>(c(),r(w,{key:t[0].toString()},[P(e("input",{type:"checkbox",id:t[0].toString(),name:t[1].name,"onUpdate:modelValue":o=>t[1].isSelected=o},null,8,Re),[[ue,t[1].isSelected]]),e("label",{for:t[0].toString()},h(t[1].name),9,Ie)],64))),128))],8,Je),j.value?(c(),r("small",Ne," 商品を選択してください ")):N("",!0),(c(!0),r(w,null,A(u.value,t=>(c(),r(w,{key:t[0]},[t[1].isSelected?(c(),r("label",He,[R(h(t[1].name)+" ",1),P(e("input",{type:"number",name:"quantity",min:"1","onUpdate:modelValue":o=>t[1].quantity=o,class:"!h-10"},null,8,Oe),[[I,t[1].quantity]])])):N("",!0)],64))),128)),e("label",null,[a[7]||(a[7]=R(" 値段 ")),e("input",{value:l.value,name:"price",class:"!h-10",readonly:""},null,8,Ge)])],8,Me),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":v.value,disabled:v.value},[e("div",Qe,[k(y(we),{class:"size-4 mr-1"}),a[8]||(a[8]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,Ue)],32)])]),e("div",Ye,[e("article",Xe,[a[11]||(a[11]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("div",null,[e("table",$e,[a[10]||(a[10]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"個数"),e("th",{scope:"col"},"総額")])],-1)),e("tbody",null,[(c(!0),r(w,null,A(y(i).counts,t=>(c(),r("tr",null,[e("th",Ke,h(t.name),1),e("td",null,h(t.price.toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,h(t.count),1),e("td",null,h(t.quantity),1),e("td",null,h((t.quantity*t.price).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1)]))),256))]),e("tfoot",null,[e("tr",null,[a[9]||(a[9]=e("th",{scope:"row",colspan:"2",class:"text-align-center"},"合計",-1)),e("td",null,h(y(i).count),1),e("td",null,h(y(i).quantity),1),e("td",null,h(z.value),1)])])])])])]),e("div",We,[e("article",Ze,[a[13]||(a[13]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",et,[a[12]||(a[12]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"商品名"),e("th",{scope:"col"},"回数"),e("th",{scope:"col"},"値段"),e("th",{scope:"col"},"購入時刻"),e("th",{scope:"col",class:"text-center"},"編集")])],-1)),e("tbody",null,[(c(!0),r(w,null,A(y(i).table,t=>(c(),r("tr",null,[e("th",tt,h(t.f3sid),1),n.value.get(t.id)?(c(),r("td",at,[P(e("select",{disabled:m.value,name:"newFoodId","onUpdate:modelValue":a[2]||(a[2]=o=>F.value=o),class:"!mb-0 !py-0 !h-8",required:""},[(c(!0),r(w,null,A(y(i).foods,o=>(c(),r("option",{value:o.id,key:o.id},h(o.name),9,st))),128))],8,nt),[[re,F.value]])])):(c(),r("td",lt,h(t.food_name),1)),n.value.get(t.id)?(c(),r("td",ot,[P(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=o=>_.value=o),class:"!mb-0 !py-0 !h-8 !w-20",disabled:m.value},null,8,it),[[I,_.value]])])):(c(),r("td",ut,h(t.quantity),1)),e("td",null,h((t.price*t.quantity).toLocaleString("ja-JP",{style:"currency",currency:"JPY"})),1),e("td",null,h(new Date(t.created_at).toLocaleTimeString("ja-JP")),1),e("td",null,[e("div",rt,[n.value.get(t.id)?(c(),r(w,{key:0},[e("button",{onClick:o=>G(t.id),disabled:m.value,class:"flex items-center justify-center size-8 p-0 mr-auto outline secondary"},[k(y(Te),{class:"m-1 size-5"})],8,ct),e("button",{onClick:o=>B(t.id),disabled:m.value,class:"flex items-center justify-center size-8 p-0 outline"},[k(y(ze),{class:"m-1 size-5"})],8,dt)],64)):(c(),r("button",{key:1,onClick:o=>U(t),disabled:m.value,class:"flex items-center justify-center size-8 p-0 mx-auto outline contrast"},[k(y(xe),{class:"m-2 size-3"})],8,pt))])])]))),256))])])])]),e("div",ht,[e("article",yt,[a[14]||(a[14]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"セット別売上割合"),e("p",null,"Percentage of total count and quantity by set")])],-1)),k(y(Ce),{data:{labels:Y.value,datasets:[{label:"回数",data:E.value,backgroundColor:[...q.slice(0,E.value.length)]},{label:"個数",data:X.value,backgroundColor:[...q.slice(0,E.value.length)]}]},options:{animation:!1,plugins:{legend:{labels:{font:{size:15}}}}}},null,8,["data"])])]),e("div",vt,[e("article",mt,[a[15]||(a[15]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数と個数のグラフ"),e("p",null,"The graph of count and quantity vs time")])],-1)),k(y(Fe),{data:{labels:y($),datasets:y(i).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),e("dialog",{open:g.value},[e("article",bt,[a[16]||(a[16]=e("header",null,[e("hgroup",{style:{"margin-bottom":"0px"}},[e("h2",null,"F3SiD"),e("p",null,"Scan the F3SiD")])],-1)),k(y(je),{paused:!g.value,onDetect:d},null,8,["paused"]),e("footer",null,[e("button",{onClick:a[4]||(a[4]=t=>{g.value=!g.value}),class:"secondary"}," Close ")])])],8,ft)]))}}),wt=qe(_t,[["__scopeId","data-v-7d42e255"]]);export{wt as default};
