import{u as j,f as F,r as f,d as A,h as B,c as _,a as e,t as v,i as o,j as D,w as T,b as P,e as M,v as N,k as g,l as R,F as H,m as O,o as S}from"./index-DY-KYBUN.js";import{S as G}from"./pure-FrWMz_Vx.js";import{C as J,A as I,p as q,a as K,b as Q,L as U,P as X,d as W,e as $,u as Y,f as Z,_ as ee,S as te,g as ae,h as se,i as ne}from"./_plugin-vue_export-helper-DXI1KwwZ.js";const w=j(),oe=F("exhibition",()=>{const y=f(0),l=f([]),i=f([]);function u(){y.value=0,l.value=[],i.value=[]}async function m(){const[a]=await Promise.all([c(),r(),b()]);return a}async function x(a){const n=new Headers;n.append("Authorization","Bearer "+w.key),n.append("Content-Type","application/json");const d="https://api.aicj.io/";try{return(await fetch(d+"protected/push/exhibition",{method:"POST",headers:n,body:JSON.stringify({f3sid:a})})).ok}catch{return!1}}async function r(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const n="https://api.aicj.io/";try{const d=await fetch(n+"protected/table",{method:"GET",headers:a}).then(p=>p.json());return l.value=d,!0}catch{return!1}}async function c(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const n="https://api.aicj.io/";try{const d=await fetch(n+"protected/count",{method:"GET",headers:a}).then(p=>p.json());return y.value=d.count,!0}catch{return!1}}async function b(){const a=new Headers;a.append("Authorization","Bearer "+w.key),a.append("Content-Type","application/json");const n="https://api.aicj.io/";try{const d=await fetch(n+"protected/data/exhibition",{method:"GET",headers:a}).then(p=>p.json());return i.value=d,!0}catch{return!1}}return{table:l,count:y,line_graph_data:i,sendExhibition:x,getTable:r,getCount:c,getData:b,update:m,clear:u}}),le={class:"container-fluid"},ie={class:"parent"},re={class:"Order"},ue={class:"mb-0"},de=["disabled"],ce=["aria-invalid"],pe={key:0,id:"f3sid-helper"},he=["aria-busy","disabled"],fe={class:"flex items-center mx-auto"},me={class:"Stats"},ve={class:"striped mb-auto"},be={scope:"row"},ye={class:"Table"},_e={style:{zoom:"1.1"}},ge={class:"striped mb-0"},Se={scope:"row"},we={class:"Line-Chart"},xe={style:{zoom:"1.1"}},Te=21,je=A({__name:"ExhibitionView",setup(y){J.register(I,q,K,Q,U,X,W,$);const l=j(),i=oe(),u=f(!1),m=f(!1),x=f(!1),r=f(""),c=f(!1),b=new G({minLength:7,alphabet:"23456789CFGHJMPQRVWX",blocklist:new Set([])}),a=async h=>{b.decode(h.rawValue).length===2&&(r.value=h.rawValue,x.value=!0,m.value=!1)},n=()=>{m.value=!m.value},d=async()=>{if(u.value=!0,r.value===""||b.decode(r.value).length!==2?(u.value=!1,c.value=!0):c.value=!1,c.value){u.value=!1;return}await i.sendExhibition(r.value)&&await i.update()&&(r.value=""),u.value=!1},p=Array(Te).fill(0).reduce((h,t,s)=>(s%2===0?h.push((s/2+8).toString().padStart(2,"0")+":00"):h.push((Math.floor(s/2)+8).toString().padStart(2,"0")+":30"),h),[]),{charging:k,chargingTime:C,dischargingTime:L,level:V}=Y(),{resume:z,isActive:E}=Z(async()=>{await l.sendStatus(k.value,C.value,L.value,V.value)},6e4,{immediate:!1});return B(()=>{(async()=>await i.update())(),!E.value&&l.canSendStatus&&z()}),(h,t)=>(S(),_("main",le,[e("div",ie,[e("div",re,[e("article",null,[e("header",null,[e("hgroup",ue,[e("h2",null,v(o(l).name),1),e("p",null,v(o(l).type.charAt(0)+o(l).type.toLowerCase().slice(1)),1)])]),e("form",{onKeydown:t[1]||(t[1]=D(T(()=>{},["prevent"]),["enter"])),onSubmit:T(d,["prevent"])},[e("fieldset",{disabled:u.value},[e("label",null,[t[3]||(t[3]=P(" F3SiD ")),e("fieldset",{role:"group",style:{"margin-top":"calc(var(--pico-spacing) * .25)"},"aria-invalid":c.value,"aria-describedby":"f3sid-helper"},[M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),name:"f3sid",class:"!h-10"},null,512),[[N,r.value]]),e("button",{type:"submit",onClick:T(n,["prevent"]),class:"flex items-center justify-center !size-10 !p-0"},[g(o(te),{class:"m-2 size-6"})])],8,ce),c.value?(S(),_("small",pe," F3SiDが無効です ")):R("",!0)])],8,de),e("button",{type:"submit",class:"mb-0 flex items-center","aria-busy":u.value,disabled:u.value},[e("div",fe,[g(o(ae),{class:"size-4 mr-1"}),t[4]||(t[4]=e("span",{class:"text-size-lg"},"送信する",-1))])],8,he)],32)])]),e("div",me,[e("article",null,[t[6]||(t[6]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"統計"),e("p",null,"Stats")])],-1)),e("table",ve,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名前"),e("th",{scope:"col"},"回数")])],-1)),e("tbody",null,[e("tr",null,[e("th",be,v(o(l).name),1),e("td",null,v(o(i).count.toLocaleString("ja-JP")),1)])])])])]),e("div",ye,[e("article",_e,[t[8]||(t[8]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"表"),e("p",null,"Table")])],-1)),e("table",ge,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"F3SiD"),e("th",{scope:"col"},"入室時刻")])],-1)),e("tbody",null,[(S(!0),_(H,null,O(o(i).table,s=>(S(),_("tr",{key:s.f3sid+s.created_at},[e("th",Se,v(s.f3sid),1),e("td",null,v(new Date(s.created_at).toLocaleTimeString("ja-JP")),1)]))),128))])])])]),e("div",we,[e("article",xe,[t[9]||(t[9]=e("header",null,[e("hgroup",{class:"mb-0"},[e("h2",null,"時間における回数のグラフ"),e("p",null,"The graph of count vs time")])],-1)),g(o(se),{data:{labels:o(p),datasets:o(i).line_graph_data},options:{animation:!1,plugins:{colors:{forceOverride:!0},legend:{labels:{font:{size:15}}}},scales:{x:{ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}},null,8,["data"])])])]),g(ee,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),onOnDetect:a},null,8,["modelValue"])]))}}),Ve=ne(je,[["__scopeId","data-v-75266cd5"]]);export{Ve as default};
